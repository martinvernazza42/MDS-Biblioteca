{% extends 'base.html' %}

{% block title %}Devolver Libro - Biblioteca{% endblock %}

{% block content %}
<h2>Registrar Devolución</h2>

<div class="card mb-4">
    <div class="card-body">
        <h5 class="card-title">{{ libro.titulo }}</h5>
        <p class="card-text">
            <strong>Autor:</strong> {{ libro.autor }}<br>
            <strong>ISBN:</strong> {{ libro.isbn }}<br>
            {% if prestamo %}
                <strong>Prestado a:</strong> {{ prestamo.socio.nombre_completo }}<br>
                <strong>Fecha préstamo:</strong> {{ prestamo.fecha_prestamo|date:"d/m/Y" }}<br>
                <strong>Fecha devolución prevista:</strong> {{ prestamo.fecha_devolucion_prevista|date:"d/m/Y" }}<br>
                {% if prestamo.esta_vencido %}
                    <span class="badge bg-danger">Vencido ({{ prestamo.dias_retraso }} días)</span>
                {% endif %}
            {% endif %}
        </p>
    </div>
</div>

{% if prestamo %}
<form method="post" class="row g-3">
    {% csrf_token %}
    <div class="col-12">
        <label class="form-label">Estado del libro devuelto:</label>
        <div class="form-check">
            <input class="form-check-input" type="radio" name="buen_estado" id="buen_estado_si" value="si" checked>
            <label class="form-check-label" for="buen_estado_si">
                En buen estado
            </label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="radio" name="buen_estado" id="buen_estado_no" value="no">
            <label class="form-check-label" for="buen_estado_no">
                Dañado o en mal estado
            </label>
        </div>
    </div>
    <div class="col-md-6" id="multa_importe" style="display: none;">
        <label for="importe" class="form-label">Importe de la multa (€)</label>
        <input type="number" step="0.01" class="form-control" name="importe" id="importe" min="0">
    </div>
    <div class="col-12">
        <button type="submit" class="btn btn-primary">Registrar Devolución</button>
        <a href="{% url 'libros:lista' %}" class="btn btn-secondary">Cancelar</a>
    </div>
</form>
{% else %}
<div class="alert alert-warning">
    Este libro no tiene un préstamo activo.
</div>
<a href="{% url 'libros:lista' %}" class="btn btn-secondary">Volver</a>
{% endif %}
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const radioNo = document.getElementById('buen_estado_no');
    const multaDiv = document.getElementById('multa_importe');
    
    document.querySelectorAll('input[name="buen_estado"]').forEach(radio => {
        radio.addEventListener('change', function() {
            multaDiv.style.display = radioNo.checked ? 'block' : 'none';
        });
    });
});
</script>
{% endblock %}